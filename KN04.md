# KN 04

## 1.

### Cloud-Config

~~~yaml
#cloud-config
users:
  - name: ubuntu
    sudo: ALL=(ALL) NOPASSWD:ALL
    groups: users, admin
    home: /home/ubuntu
    shell: /bin/bash
    ssh_authorized_keys:
      - ssh-rsa MIIEowIBAAKCAQEAlcJxcoGxcEeWUrkCeTVrgqXIBRBoPMByTYJorcFyLcjwubBnKXeIC6OpwGZ1Nu9HTChr662SkNkJ/zpxNxblUCBA7cuFvc3Hep+pKkiqlcnNHK//P0wtX0AsIXVtzuLJ6vygYTS+ZK1UZv9+UWigxw2j63nzzoeLErA4yFahMgqEAQd2NImWnKsOL5TbVuSIsWCAmna2KBLo99sX7IPvxOjRzO/Wf0NTsHCBnLCYuGiCqhADQrUAsIUK/CPviIUvvKH+EZdfpvdH2SG9SS7yFLuZhW6685/JSVEe0FQie598dJ3RLodYKw+tJoLpv3PQPRgVjKDVJKta2qaQTLLcWQIDAQABAoIBAQCDbRL2dI7thEWN70MWcCUbkLWKjC2OMy2ci/ellQDI4XEw5HiEUZwY6tZMPR5cyXx+f3LGb5sSdwZo8DbvK66utL+GcHe8bFzFZlyk+QSLU4AnzuRn/khLMRwJeO6XAzxEdtOguxLjc6GAinOmqfV++p+CRZILC7Sm//O1DSGFsZEeEjm34am2oCCc+WbRwpXTdjN47wiWgAT+12du05VjOmsDpFdBoRJSSfedQmmKuvEhfAy/zOcLhxtfCI37zP1+fwjWgj8IJYy/YUuNg4rAohC7pRgiPvhohO89+Ma1lJuWXVty4PYeD0XbaPNV/UOkldAz6ntbDrhgcB7z/FLpAoGBAMT4CP0CCSSW4eAU/5+9ypbbIfGvTM7cuzf1NerPO73A5d8Rb3XxywELIQcnoT53Ki5meoAOVNOllVoHzyJ5b4ttHkMCwCsnC2oUlwDw2ivs6zhDYDybXYwxje5czSUBwmHLOhfTapA1m3sT5Y5URtHMeWQC8q+KNMBeJnLKjCtbAoGBAMKkYm/bwLQBGFm/Dz873xgdtgDqNXp8KxW5zAGeB5vuIX2PySYDE0P4CYH00u4Ne+pBQ6NcJK3NTAMBVCoYEkeq+2xoxAFPdtWQj9mu2v/7ugwTCTu7kQmvXFEVJ7vY+kV6EfwstBrVZBVA2Vh3xQkvfnSISdlpYp7etQPFj8lbAoGAEoXMupY9a95wgVUYMNp1ObiDuamljHJ/fKSnnFw+nvqL421NUQca8w8r3PNiG3CzW8exT2eJnJmesOe5F+HZln/9b4nLroMudJxZEvKTYbwW5qSXYTuvEWb7lOXPOOKwd+fXn7P2+nbAF1Poq3jLbCFRbRFF5zIVAd4YuYTIp68CgYB/YCQrH5xUMANHeAj6UKwGlCrvHlYw+eEYLqaayFgiawvvp5DzF0AcUs2mBhmjP5/ABUXGOh6mvprnvI7fnTEZRYOTxlu+n8ocqKX6xrr6mjl+fValiHG57NB1H2sJO01M+j2a0YZrqQn9/po9kuOWx0Xx7N6nMJghb4z2Euut0QKBgEbhkpzOtr7VLr/svne2OczlF5Ocu9MscMwP4CqSw+vCIYLo2RNtpgkA5JNyB9o2Y6a2YLUmQXo4MM5TiXK+jiscVGg64EQxYK8IbEVBNL1rOrQwjBxONHMDa4H3ORwOn5yFo8FsmX4jlMXm9VSJIXPYXKtBdrvBBLmGtmX6PdHj aws-key
ssh_pwauth: false
disable_root: false 
package_update: true
packages:
  - curl 
  - wget 
~~~

### Cloud-Config Erklärung

Diese Cloud-Config macht Folgendes:

- **users**: legt alle Benutzer an
- **name**: Benutzername
- **sudo**: welche Befehle der Benutzer mit `sudo` ausführen darf
- **groups**: die Gruppen der Benutzer drinnen ist
- **home**: persönliche Ordner des Benutzers
- **shell**: welche Shell der Benutzer nutzt
- **ssh_authorized_keys**: öffentliche SSH-Schlüssel
- **ssh_pwauth**: legt fest, ob man sich mit Passwort anmelden darf
- **disable_root**: bestimmt, ob der Root-Account deaktiviert ist
- **package_update**: aktualisiert die Paketlisten
- **packages**: Liste von Packages die an will

eron - cloud-init

eron1 - eigenschaft in einst

34.229.247.218

## 2. Public Key erzeugen

```bash
ssh-keygen -y -f eron.pem > eron.pub
ssh-keygen -y -f eron1.pem > eron1.pub
```

Cloud-Config:

```yaml
#cloud-config
users:
  - name: ubuntu
    sudo: ALL=(ALL) NOPASSWD:ALL
    groups: users, admin
    home: /home/ubuntu
    shell: /bin/bash
    ssh_authorized_keys:
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDOAqkvNWcdUIx2kNhrDLDB7/w47RYC02W5QcSLvHwEGYduetmhy+Rzbl4gjetG6kF6OfSkbmS8/iHPPeWtT7zD6ZXxjFAedwY0ubYoqvchulKAXPYzxFAEFBvAD1D2L2RlFwT+SHy+3VYSbET0ZuP3yVjtBueL/3uqjqzniD0GHzR0cG3qQABHmqf752q1XqsX0t0Ra04l3hqm/wrTLypAHl5kzhmbCBSXK4OjuXx75+iNg9WInTnA2YqDldf+AAVZfGXtU6+YdqCW1Fqb3VB9PaVWW1aa2TBdKZj/dqiEaU38RX1PdaI00gRyva6IvKXbDdPLJI6QiDdqAZ80fDVX

ssh_pwauth: false
disable_root: false
package_update: true
packages:
  - curl
  - wget
```

## 3. Mit zusätzlichem Key

```yaml
#cloud-config
users:
  - name: ubuntu
    sudo: ALL=(ALL) NOPASSWD:ALL
    groups: users, admin
    home: /home/ubuntu
    shell: /bin/bash
    ssh_authorized_keys:
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDOAqkvNWcdUIx2kNhrDLDB7/w47RYC02W5QcSLvHwEGYduetmhy+Rzbl4gjetG6kF6OfSkbmS8/iHPPeWtT7zD6ZXxjFAedwY0ubYoqvchulKAXPYzxFAEFBvAD1D2L2RlFwT+SHy+3VYSbET0ZuP3yVjtBueL/3uqjqzniD0GHzR0cG3qQABHmqf752q1XqsX0t0Ra04l3hqm/wrTLypAHl5kzhmbCBSXK4OjuXx75+iNg9WInTnA2YqDldf+AAVZfGXtU6+YdqCW1Fqb3VB9PaVWW1aa2TBdKZj/dqiEaU38RX1PdaI00gRyva6IvKXbDdPLJI6QiDdqAZ80fDVX
      - "Lehrer Key"
ssh_pwauth: false
disable_root: false
package_update: true
packages:
  - curl
  - wget
```

## 4. Instanzen einrichten

### Datenbank
- Datei: `cloud-init-db.yaml`
- Installiert: MariaDB-Server  
- Admin-Benutzer anlegen  
- Remote-Zugriff aktivieren:  
  ```bash
  sudo sed -i 's/127.0.0.1/0.0.0.0/g' /etc/mysql/mariadb.conf.d/50-server.cnf
  ```

**Abgabe:**  
- Cloud-Init im Git  
- Screenshot Konfiguration  

### Webserver
- Datei: `cloud-init-web.yaml`
- Installiert: Apache2, PHP, PHP-MySQL, Adminer  
- Dateien mit `write_files`:  
  - index.html  
  - info.php  
  - db.php  

Befehle:  
```bash
sudo a2enconf adminer
sudo systemctl restart apache2
```

### Debugging
- Log: `/var/log/cloud-init-output.log`  
- DB-Test: `mysql -u admin -p`  
- Port-Test: `telnet <IP> 3306`